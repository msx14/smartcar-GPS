#ifndef _PID_H
#define _PID_H

#include "headfile.h"
#include <stdbool.h>

#define DEFAULT_PID_INTEGRATION_LIMIT  		5000.0
#define SENSOR9_UPDATE_DT                       0.002
#define PID_ANGLE_PITCH_INTEGRATION_LIMIT       300.0
#define PID_RATE_PITCH_INTEGRATION_LIMIT	200.0

typedef struct 
{
  float kp;
  float ki;
  float kd;
} pidInit_t;

typedef struct
{
  float AngleOut;
  int RateOut;
}_PID_OUT;

typedef struct
{
  float desired;      //< set point
  float error;        //< error
  float prevError;    //< previous error
  float integ;        //< integral
  float deriv;        //< derivative
  float kp;           //< proportional gain
  float ki;           //< integral gain
  float kd;           //< derivative gain
  float outP;         //< proportional output (debugging)
  float outI;         //< integral output (debugging)
  float outD;         //< derivative output (debugging)
  float iLimit;       //< integral limit
  float iLimitLow;    //< integral limit
  float dt;           //< delta-time dt
} PidObject;

/*pid结构体初始化*/
void pidInit(PidObject* pid, const float desired, const pidInit_t pidParam, const float dt);
void pidSetIntegralLimit(PidObject* pid, const float limit);/*pid积分限幅设置*/
void pidSetDesired(PidObject* pid, const float desired);	/*pid设置期望值*/
float pidUpdate(PidObject* pid, const float error);			/*pid更新*/
float pidGetDesired(PidObject* pid);	/*pid获取期望值*/
bool pidIsActive(PidObject* pid);		/*pid状态*/
void pidReset(PidObject* pid);			/*pid结构体复位*/
void pidSetError(PidObject* pid, const float error);/*pid偏差设置*/
void pidSetKp(PidObject* pid, const float kp);		/*pid Kp设置*/
void pidSetKi(PidObject* pid, const float ki);		/*pid Ki设置*/
void pidSetKd(PidObject* pid, const float kd);		/*pid Kd设置*/
void pidSetDt(PidObject* pid, const float dt);		/*pid dt设置*/


void attitudeControlInit();
int AngleCtrl(float SetAngle);

#endif
